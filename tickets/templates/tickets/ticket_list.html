{% extends "tickets/tickets_base.html" %}

{% load ticket_extras %}

{% block title %} View Tickets - {% endblock %}


{% block extra_head %}

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.10/css/dataTables.bootstrap.min.css">


{% endblock %}

{% block content %}

<div class="container">

  <table id=ticket_table cellspacing="0" class="table display">
    <thead>
      <tr>
        <th>Ticket</th>
        <th>Status</th>
        <th>Description</th>
        <th>Application</th>
        <th>Submitted By</th>
        <th>Submitted On</th>
        <th>Ticket Type</th>
        <th>Priority</th>
        <th>Votes</th>
        <th>Assigned to</th>
      </tr>

      <tr id="filterrow">
        <th>Ticket</th>
        <th>Status</th>
        <th>Description</th>
        <th>Application</th>
        <th>Submitted By</th>
        <th>Submitted On</th>
        <th>Ticket Type</th>
        <th>Priority</th>
        <th>Votes</th>
        <th>Assigned to</th>
      </tr>
    </thead>
    <tbody>
      {% for object in object_list %}
      <tr>
        <td><a href="{{ object.get_absolute_url }}">{{object.id}}</a></td>
        <td>{{object.status | status_btn }}</td>
        <td><a href="{{ object.get_absolute_url }}">{{  object.name }}</a></td>
        <td>{{object.application}}</td>
        <td>{{object.submitted_by}}</td>
        <td>{{object.created_on}}</td>
        <td>{{object.ticket_type | ticket_type_btn }}</td>

        <td>{{object.priority | priority_btn }}</td>
        <td>{{object.votes}}</td>
        {% if object.assigned_to %}
        <td>{{ object.assigned_to }} </td>
        {% else %} <td>Nobody (yet)</td> {% endif %}

      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


{% block javascript %}

{{ block.super }}

<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.10/js/dataTables.bootstrap.min.js"></script>

{% endblock %}

<script>
// $(function(){
//   $("#ticket_table").dataTable();
// })


 $('#ticket_table thead tr#filterrow th').each( function () {
   var title = $('#ticket_table thead th').eq( $(this).index() ).text();
   $(this).html( '<input type="text" onclick="stopPropagation(event);" placeholder="Search '+title+'" />' );
 } );

 // DataTable
 var table = $('#ticket_table').DataTable( {
//   orderCellsTop: true
 } );

 // Apply the filter
 $("#ticket_table thead input").on( 'keyup change', function () {
   table
            .column( $(this).parent().index()+':visible' )
            .search( this.value )
            .draw();
 } );

 function stopPropagation(evt) {
   if (evt.stopPropagation !== undefined) {
     evt.stopPropagation();
   } else {
     evt.cancelBubble = true;
   }
 }


</script>


{% endblock %}
